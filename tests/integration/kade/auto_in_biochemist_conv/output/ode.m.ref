function main=main()
% command line: 
%      'KaDE' 'auto.ka' '-d' 'output' '-l' '1' '-p' '0.01' '-syntax' '4''--rate-convention''Biochemist'
%% THINGS THAT ARE KNOWN FROM KAPPA FILE AND KaSim OPTIONS:
%% 
%% init - the initial abundances of each species and token
%% tinit - the initial simulation time (likely 0)
%% tend - the final simulation time 
%% initialstep - initial time step at the beginning of numerical integration
%% maxstep - maximal time step for numerical integration
%% reltol - relative error tolerance;
%% abstol - absolute error tolerance;
%% period - the time period between points to return
%%
%% variables (init(i),y(i)) denote numbers of embeddings 
%% rule rates are corrected by the number of automorphisms that induce an automorphism in the rhs as well


tinit=0;
tend=1;
initialstep=1e-05;
maxstep=0.02;
reltol=0.001;
abstol=0.001;
period=0.01;
nonnegative=false;

global nodevar
nodevar=7;
global max_stoc_coef
max_stoc_coef=0;
nvar=6;
nobs=3;
nrules=9;

global var
var=zeros(nvar,1);
global init
init=sparse(nodevar,1);
global k
global kd
global kun
global kdun
global stoc

stoc=zeros(nrules,max_stoc_coef);
k=zeros(nrules,1);
kd=zeros(nrules,1);
kun=zeros(nrules,1);
kdun=zeros(nrules,1);
global jacvar
jacvar=sparse(nvar,nodevar);
global jack
global jackd
global jackun
global jackund
global jacstoc

jack=zeros(nrules,nodevar);
jackd=zeros(nrules,nodevar);
jackun=zeros(nrules,nodevar);
jackund=zeros(nrules,nodevar);

t = 0.000000;

init(7)=t;
init(1)=6; % B()
init(2)=4.5; % A()
init(4)=10; % E(r[.])
init(3)=100; % R(e[.],r[.])
var(2)=init(3)+init(5); % monomers
var(1)=init(6)/2; % dimmers

k(1)=3; % R(e[_],r[.]), R(e[_],r[.]) -> R(e[_],r[1]), R(e[_],r[1])
k(2)=4; % R(e[_],r[1]), R(e[_],r[1]) -> R(e[_],r[.]), R(e[_],r[.])
k(3)=5; % A(), A(), B(), B(), B() -> ., ., ., ., .
k(4)=7; % R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), . -> R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B(x[.])
k(5)=8; % R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
k(6)=1; % E(r[.]), R(e[.]), ., . -> E(r[1]), R(e[1]), R(e[2],r[.]), E(r[2])
k(7)=1; % E(r[.]), E(r[.]), . -> E(r[.]), E(r[1]), R(e[1],r[.])
k(8)=1; % E(r[.]), E(r[.]), R(e[.],r[.]), . -> E(r[2]), E(r[1]), R(e[1],r[.]), R(e[2],r[.])
k(9)=1; % E(r[.]), E(r[.]), ., . -> E(r[2]), E(r[1]), R(e[1],r[.]), R(e[2],r[.])

uiIsOctave = false;
uiIsMatlab = false;
LIC = license('inuse');
for elem = 1:numel(LIC)
    envStr = LIC(elem).feature
    if strcmpi(envStr,'octave')
       LICname=envStr;
       uiIsOctave = true;
       break
    end
    if strcmpi(envStr,'matlab')
       LICname=envStr
       uiIsMatlab = true;
       break
    end
end


if nonnegative 
   options = odeset('RelTol', reltol, ...
                    'AbsTol', abstol, ...
                    'InitialStep', initialstep, ...
                    'MaxStep', maxstep, ...
                    'Jacobian', @ode_jacobian, ...
                   'NonNegative', [1:1:6]);
else
   options = odeset('RelTol', reltol, ...
                    'AbsTol', abstol, ...
                    'InitialStep', initialstep, ...
                    'MaxStep', maxstep, ...
                    'Jacobian', @ode_jacobian);
end


if nonnegative
   if uiIsMatlab
      soln =  ode15s(@ode_aux,[tinit tend],ode_init(),options);
      soln.y=soln.y';
      vt = soln.x;
      vy = soln.y;
   elseif uiIsOctave
      [vt,vy] = ode45(@ode_aux,[tinit tend],ode_init(),options);
   end
else
   if uiIsMatlab
      soln =  ode15s(@ode_aux,[tinit tend],ode_init(),options);
      soln.y=soln.y';
      vt = soln.x;
      vy = soln.y;
   elseif uiIsOctave
      soln = ode45(@ode_aux,[tinit tend],ode_init(),options);
      vt = soln.x;
      vy = soln.y;
   end
end;


nrows = length(vt);

tmp = zeros(nodevar,1);

n_points = floor ((tend-tinit)/period)+1;
t = linspace(tinit, tend, n_points);
obs = zeros(nrows,nobs);

for j=1:nrows
    for i=1:nodevar
        z(i)=vy(i,j);
    end
    h=ode_obs(z);
    for i=1:nobs
        obs(j,i)=h(i);
    end
end
if nobs==1
   y = interp1(vt, obs, t, 'pchip')';
else
   y = interp1(vt, obs, t, 'pchip');
end


filename = 'data.csv';
fid = fopen (filename,'w');
fprintf(fid,'# KaDE auto.ka -d output -l 1 -p 0.01 -syntax 4 --rate-convention Biochemist\n')
fprintf(fid,'# ')
fprintf(fid,'[T] ')
fprintf(fid,'dimmers ')
fprintf(fid,'monomers ')
fprintf(fid,'\n')
for j=1:n_points
    for i=1:nobs
        fprintf(fid,'%f ',y(j,i));
    end
    fprintf(fid,'\n');
end
fclose(fid);


end



function Init=ode_init()

global nodevar
global init
Init=zeros(nodevar,1);

Init(1) = init(1); % B()
Init(2) = init(2); % A()
Init(3) = init(3); % R(e[.],r[.])
Init(4) = init(4); % E(r[.])
Init(5) = init(5); % R(e[1],r[.]), E(r[1])
Init(6) = init(6); % R(e[1],r[2]), R(e[3],r[2]), E(r[3]), E(r[1])
Init(7) = init(7); % t
end


function dydt=ode_aux(t,y)

global nodevar
global max_stoc_coef
global var
global k
global kd
global kun
global kdun
global stoc

var(2)=y(3)+y(5); % monomers
var(1)=y(6)/2; % dimmers


dydt=zeros(nodevar,1);

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(6)=dydt(6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(1)=dydt(1)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;
dydt(5)=dydt(5)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2*y(6)/2;

% rule    : R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), . -> R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B(x[.])
% reaction: R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B() -> R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B()

dydt(1)=dydt(1)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(1)=dydt(1)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(5)=dydt(5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(5)=dydt(5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(5)=dydt(5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(5)=dydt(5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(1)=dydt(1)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(1)=dydt(1)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(1)=dydt(1)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(6)=dydt(6)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);
dydt(6)=dydt(6)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5)*y(5);

% rule    : A(), A(), B(), B(), B() -> ., ., ., ., .
% reaction: A() + A() + B() + B() + B() -> 

dydt(1)=dydt(1)-1/12*k(3)*y(1)*y(1)*y(1)*y(2)*y(2);
dydt(1)=dydt(1)-1/12*k(3)*y(1)*y(1)*y(1)*y(2)*y(2);
dydt(1)=dydt(1)-1/12*k(3)*y(1)*y(1)*y(1)*y(2)*y(2);
dydt(2)=dydt(2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2)*y(2);
dydt(2)=dydt(2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2)*y(2);

% rule    : E(r[.]), R(e[.]), ., . -> E(r[1]), R(e[1]), R(e[2],r[.]), E(r[2])
% reaction: E(r[.]) + R(e[.],r[.]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

dydt(3)=dydt(3)-k(6)*y(3)*y(4);
dydt(4)=dydt(4)-k(6)*y(3)*y(4);
dydt(5)=dydt(5)+k(6)*y(3)*y(4);
dydt(5)=dydt(5)+k(6)*y(3)*y(4);

% rule    : E(r[.]), E(r[.]), R(e[.],r[.]), . -> E(r[2]), E(r[1]), R(e[1],r[.]), R(e[2],r[.])
% reaction: E(r[.]) + E(r[.]) + R(e[.],r[.]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

dydt(3)=dydt(3)-k(8)*y(3)*y(4)*y(4);
dydt(4)=dydt(4)-k(8)*y(3)*y(4)*y(4);
dydt(4)=dydt(4)-k(8)*y(3)*y(4)*y(4);
dydt(5)=dydt(5)+k(8)*y(3)*y(4)*y(4);
dydt(5)=dydt(5)+k(8)*y(3)*y(4)*y(4);

% rule    : R(e[_],r[1]), R(e[_],r[1]) -> R(e[_],r[.]), R(e[_],r[.])
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

dydt(6)=dydt(6)-2/2*k(2)*y(6)/2;
dydt(5)=dydt(5)+1/2*k(2)*y(6)/2;
dydt(5)=dydt(5)+1/2*k(2)*y(6)/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]) -> R(e[_],r[.]), R(e[_],r[.])
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

dydt(6)=dydt(6)-2/2*k(2)*y(6)/2;
dydt(5)=dydt(5)+1/2*k(2)*y(6)/2;
dydt(5)=dydt(5)+1/2*k(2)*y(6)/2;

% rule    : R(e[_],r[.]), R(e[_],r[.]) -> R(e[_],r[1]), R(e[_],r[1])
% reaction: R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) -> R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1])

dydt(5)=dydt(5)-1/2*k(1)*y(5)*y(5);
dydt(5)=dydt(5)-1/2*k(1)*y(5)*y(5);
dydt(6)=dydt(6)+2/2*k(1)*y(5)*y(5);

% rule    : E(r[.]), E(r[.]), ., . -> E(r[2]), E(r[1]), R(e[1],r[.]), R(e[2],r[.])
% reaction: E(r[.]) + E(r[.]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

dydt(4)=dydt(4)-1/2*k(9)*y(4)*y(4);
dydt(4)=dydt(4)-1/2*k(9)*y(4)*y(4);
dydt(5)=dydt(5)+1/2*k(9)*y(4)*y(4);
dydt(5)=dydt(5)+1/2*k(9)*y(4)*y(4);

% rule    : E(r[.]), E(r[.]), . -> E(r[.]), E(r[1]), R(e[1],r[.])
% reaction: E(r[.]) + E(r[.]) -> E(r[.]) + R(e[1],r[.]).E(r[1])

dydt(4)=dydt(4)-k(7)*y(4)*y(4);
dydt(4)=dydt(4)-k(7)*y(4)*y(4);
dydt(5)=dydt(5)+k(7)*y(4)*y(4);
dydt(4)=dydt(4)+k(7)*y(4)*y(4);
dydt(7)=1;

end


function jac=ode_jacobian(t,y)

global nodevar
global max_stoc_coef
global jacvar
global var
global k
global kd
global kun
global kdun
global stoc

global jack
global jackd
global jackun
global jackund
global jacstoc

var(2)=y(3)+y(5); % monomers
var(1)=y(6)/2; % dimmers

jacvar(2,3)=1;
jacvar(2,5)=1;
jacvar(1,6)=2/4;


jac=sparse(nodevar,nodevar);

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B() -> R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), .
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B() -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B()

jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)-1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)-1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)-1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(6,1)=jac(6,1)-2/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(6,1)=jac(6,1)-2/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(6,6)=jac(6,6)-2/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(1,1)=jac(1,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(1,1)=jac(1,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(1,6)=jac(1,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;
jac(5,1)=jac(5,1)+1/16*k(5)*y(6)/2*y(6)/2*y(1)*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(6)/2*y(6)/2*y(1);
jac(5,1)=jac(5,1)+1/16*k(5)*y(1)*y(1)*y(6)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)/2*y(6)/2;
jac(5,6)=jac(5,6)+1/16*k(5)*y(1)*y(1)*y(1)*y(6)/2/2;

% rule    : R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), R(e[_],r[.]), B(), B(), . -> R(e[_],r[1]), R(e[_],r[1]), R(e[_],r[2]), R(e[_],r[2]), B(), B(), B(x[.])
% reaction: R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) + B() + B() -> R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) + B() + B() + B()

jac(1,1)=jac(1,1)-1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(1,1)=jac(1,1)-1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,1)=jac(1,1)-1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(1,1)=jac(1,1)-1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,1)=jac(5,1)-1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(5,1)=jac(5,1)-1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,1)=jac(5,1)-1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(5,1)=jac(5,1)-1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,1)=jac(5,1)-1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(5,1)=jac(5,1)-1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,1)=jac(5,1)-1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(5,1)=jac(5,1)-1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(5,5)=jac(5,5)-1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,1)=jac(1,1)+1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(1,1)=jac(1,1)+1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,1)=jac(1,1)+1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(1,1)=jac(1,1)+1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,1)=jac(1,1)+1/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(1,1)=jac(1,1)+1/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(1,5)=jac(1,5)+1/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,1)=jac(6,1)+2/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(6,1)=jac(6,1)+2/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,1)=jac(6,1)+2/16*k(4)*y(5)*y(5)*y(5)*y(5)*y(1);
jac(6,1)=jac(6,1)+2/16*k(4)*y(1)*y(5)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);
jac(6,5)=jac(6,5)+2/16*k(4)*y(1)*y(1)*y(5)*y(5)*y(5);

% rule    : A(), A(), B(), B(), B() -> ., ., ., ., .
% reaction: A() + A() + B() + B() + B() -> 

jac(1,1)=jac(1,1)-1/12*k(3)*y(2)*y(2)*y(1)*y(1);
jac(1,1)=jac(1,1)-1/12*k(3)*y(1)*y(2)*y(2)*y(1);
jac(1,1)=jac(1,1)-1/12*k(3)*y(1)*y(1)*y(2)*y(2);
jac(1,2)=jac(1,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(1,2)=jac(1,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(1,1)=jac(1,1)-1/12*k(3)*y(2)*y(2)*y(1)*y(1);
jac(1,1)=jac(1,1)-1/12*k(3)*y(1)*y(2)*y(2)*y(1);
jac(1,1)=jac(1,1)-1/12*k(3)*y(1)*y(1)*y(2)*y(2);
jac(1,2)=jac(1,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(1,2)=jac(1,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(1,1)=jac(1,1)-1/12*k(3)*y(2)*y(2)*y(1)*y(1);
jac(1,1)=jac(1,1)-1/12*k(3)*y(1)*y(2)*y(2)*y(1);
jac(1,1)=jac(1,1)-1/12*k(3)*y(1)*y(1)*y(2)*y(2);
jac(1,2)=jac(1,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(1,2)=jac(1,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(2,1)=jac(2,1)-1/12*k(3)*y(2)*y(2)*y(1)*y(1);
jac(2,1)=jac(2,1)-1/12*k(3)*y(1)*y(2)*y(2)*y(1);
jac(2,1)=jac(2,1)-1/12*k(3)*y(1)*y(1)*y(2)*y(2);
jac(2,2)=jac(2,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(2,2)=jac(2,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(2,1)=jac(2,1)-1/12*k(3)*y(2)*y(2)*y(1)*y(1);
jac(2,1)=jac(2,1)-1/12*k(3)*y(1)*y(2)*y(2)*y(1);
jac(2,1)=jac(2,1)-1/12*k(3)*y(1)*y(1)*y(2)*y(2);
jac(2,2)=jac(2,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);
jac(2,2)=jac(2,2)-1/12*k(3)*y(1)*y(1)*y(1)*y(2);

% rule    : E(r[.]), R(e[.]), ., . -> E(r[1]), R(e[1]), R(e[2],r[.]), E(r[2])
% reaction: E(r[.]) + R(e[.],r[.]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

jac(3,3)=jac(3,3)-k(6)*y(4);
jac(3,4)=jac(3,4)-k(6)*y(3);
jac(4,3)=jac(4,3)-k(6)*y(4);
jac(4,4)=jac(4,4)-k(6)*y(3);
jac(5,3)=jac(5,3)+k(6)*y(4);
jac(5,4)=jac(5,4)+k(6)*y(3);
jac(5,3)=jac(5,3)+k(6)*y(4);
jac(5,4)=jac(5,4)+k(6)*y(3);

% rule    : E(r[.]), E(r[.]), R(e[.],r[.]), . -> E(r[2]), E(r[1]), R(e[1],r[.]), R(e[2],r[.])
% reaction: E(r[.]) + E(r[.]) + R(e[.],r[.]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

jac(3,3)=jac(3,3)-k(8)*y(4)*y(4);
jac(3,4)=jac(3,4)-k(8)*y(3)*y(4);
jac(3,4)=jac(3,4)-k(8)*y(3)*y(4);
jac(4,3)=jac(4,3)-k(8)*y(4)*y(4);
jac(4,4)=jac(4,4)-k(8)*y(3)*y(4);
jac(4,4)=jac(4,4)-k(8)*y(3)*y(4);
jac(4,3)=jac(4,3)-k(8)*y(4)*y(4);
jac(4,4)=jac(4,4)-k(8)*y(3)*y(4);
jac(4,4)=jac(4,4)-k(8)*y(3)*y(4);
jac(5,3)=jac(5,3)+k(8)*y(4)*y(4);
jac(5,4)=jac(5,4)+k(8)*y(3)*y(4);
jac(5,4)=jac(5,4)+k(8)*y(3)*y(4);
jac(5,3)=jac(5,3)+k(8)*y(4)*y(4);
jac(5,4)=jac(5,4)+k(8)*y(3)*y(4);
jac(5,4)=jac(5,4)+k(8)*y(3)*y(4);

% rule    : R(e[_],r[1]), R(e[_],r[1]) -> R(e[_],r[.]), R(e[_],r[.])
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

jac(6,6)=jac(6,6)-2/2*k(2)/2;
jac(5,6)=jac(5,6)+1/2*k(2)/2;
jac(5,6)=jac(5,6)+1/2*k(2)/2;

% rule    : R(e[_],r[1]), R(e[_],r[1]) -> R(e[_],r[.]), R(e[_],r[.])
% reaction: R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

jac(6,6)=jac(6,6)-2/2*k(2)/2;
jac(5,6)=jac(5,6)+1/2*k(2)/2;
jac(5,6)=jac(5,6)+1/2*k(2)/2;

% rule    : R(e[_],r[.]), R(e[_],r[.]) -> R(e[_],r[1]), R(e[_],r[1])
% reaction: R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1]) -> R(e[1],r[2]).R(e[3],r[2]).E(r[3]).E(r[1])

jac(5,5)=jac(5,5)-1/2*k(1)*y(5);
jac(5,5)=jac(5,5)-1/2*k(1)*y(5);
jac(5,5)=jac(5,5)-1/2*k(1)*y(5);
jac(5,5)=jac(5,5)-1/2*k(1)*y(5);
jac(6,5)=jac(6,5)+2/2*k(1)*y(5);
jac(6,5)=jac(6,5)+2/2*k(1)*y(5);

% rule    : E(r[.]), E(r[.]), ., . -> E(r[2]), E(r[1]), R(e[1],r[.]), R(e[2],r[.])
% reaction: E(r[.]) + E(r[.]) -> R(e[1],r[.]).E(r[1]) + R(e[1],r[.]).E(r[1])

jac(4,4)=jac(4,4)-1/2*k(9)*y(4);
jac(4,4)=jac(4,4)-1/2*k(9)*y(4);
jac(4,4)=jac(4,4)-1/2*k(9)*y(4);
jac(4,4)=jac(4,4)-1/2*k(9)*y(4);
jac(5,4)=jac(5,4)+1/2*k(9)*y(4);
jac(5,4)=jac(5,4)+1/2*k(9)*y(4);
jac(5,4)=jac(5,4)+1/2*k(9)*y(4);
jac(5,4)=jac(5,4)+1/2*k(9)*y(4);

% rule    : E(r[.]), E(r[.]), . -> E(r[.]), E(r[1]), R(e[1],r[.])
% reaction: E(r[.]) + E(r[.]) -> E(r[.]) + R(e[1],r[.]).E(r[1])

jac(4,4)=jac(4,4)-k(7)*y(4);
jac(4,4)=jac(4,4)-k(7)*y(4);
jac(4,4)=jac(4,4)-k(7)*y(4);
jac(4,4)=jac(4,4)-k(7)*y(4);
jac(5,4)=jac(5,4)+k(7)*y(4);
jac(5,4)=jac(5,4)+k(7)*y(4);
jac(4,4)=jac(4,4)+k(7)*y(4);
jac(4,4)=jac(4,4)+k(7)*y(4);
end


function obs=ode_obs(y)

global nobs
global var
obs=zeros(nobs,1);

t = y(7);
var(2)=y(3)+y(5); % monomers
var(1)=y(6)/2; % dimmers

obs(1)=t; % [T]
obs(2)=var(1); % dimmers
obs(3)=var(2); % monomers

end


main();

